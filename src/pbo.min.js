function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}var stream=function(){function t(e){_classCallCheck(this,t),this.buf=null==e?[]:e,this.offset=0}return _createClass(t,[{key:"writeInt",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=[],r=0;r<4;r++){var i=255&t;e.push(i),t=(t-i)/256}this.buf=this.buf.concat(e),this.offset+=4}},{key:"getInt",value:function(){var t=new DataView(this.buf,this.offset);return this.offset+=4,t.getUint32(0,!0)}},{key:"writeString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[],i=0;i<t.length;i++)r.push(t.charCodeAt(i));e&&r.push(0),this.buf=this.buf.concat(r),this.offset+=t.length+1}},{key:"getString",value:function(){var t=new Uint8Array(this.buf).subarray(this.offset),e=[],r=!0,i=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;if(0==l)break;e.push(l)}}catch(t){i=!0,n=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}var o=new TextDecoder("utf-8").decode(new Uint8Array(e));return this.offset+=e.length+1,o}},{key:"writeFixedString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.writeString(t,e)}},{key:"getFixedString",value:function(t){var e=new Uint8Array(this.buf).subarray(this.offset,this.offset+t);this.offset+=t;var r=[],i=!0,n=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var o=s.value;r.push(o)}}catch(t){n=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(n)throw a}}return new TextDecoder("utf-8").decode(new Uint8Array(r))}},{key:"closeWrite",value:function(){if(null!=sha1){var t=[0].concat(sha1.array(this.buf));this.buf=this.buf.concat(t)}this.buf=Uint8Array.from(this.buf).buffer,this.offset=0}},{key:"hexString",value:function(){var t=new Uint8Array(this.buf),e="",r=!0,i=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){e+=("0"+a.value.toString(16)).slice(-2)+" "}}catch(t){i=!0,n=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}return e}}]),t}(),pbo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,t),this.stream=new stream(e),this.files=[]}return _createClass(t,[{key:"getEntry",value:function(){var t={};return t.filename=this.stream.getString(),t.method=this.stream.getFixedString(4),t.originalSize=this.stream.getInt(),t.reserved=this.stream.getInt(),t.timestamp=this.stream.getInt(),t.dataSize=this.stream.getInt(),t}},{key:"setEntry",value:function(t){this.stream.writeString(t.filename),this.stream.writeFixedString(t.method),this.stream.writeInt(t.originalSize),this.stream.writeInt(t.reserved),this.stream.writeInt(t.timestamp),this.stream.writeInt(t.dataSize)}},{key:"getExtensions",value:function(){var t,e=[];do{""!=(t=this.stream.getString())&&e.push(t)}while(""!=t);return e}},{key:"setExtensions",value:function(t){var e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var s=n.value;this.stream.writeString(s)}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"getFileContents",value:function(){var t=!0,e=!1,r=void 0;try{for(var i,n=this.files[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var a=i.value;a.data=this.stream.getFixedString(a.size)}}catch(t){e=!0,r=t}finally{try{t||null==n.return||n.return()}finally{if(e)throw r}}}},{key:"setFileContents",value:function(t){var e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var s=n.value;this.stream.writeFixedString(s.data,!1)}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"getFiles",value:function(){for(;;){var t=this.stream.getString(),e=this.stream.getInt(),r=this.stream.getInt();this.stream.getInt();var i=this.stream.getInt(),n=this.stream.getInt();if(0==e&&(r=n),""==t&&1449489011!=e)break;if(1449489011==e)for(var a=this.stream.getString();""!=a;)a=this.stream.getString();else this.files.push({name:t,size:n,originalSize:r,timestamp:i,packing:e,data:""})}return this.getFileContents(),this.files}},{key:"setFiles",value:function(t){t.push({});var e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var s=n.value;this.stream.writeString(s.name),this.stream.writeInt(s.packing),this.stream.writeInt(s.originalSize),this.stream.writeInt(0),this.stream.writeInt(s.timestamp),this.stream.writeInt(s.size)}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"parsePbo",value:function(){var t={};return t.entry=this.getEntry(),t.extensions=this.getExtensions(),t.files=this.getFiles(),t}},{key:"writePbo",value:function(e){var r=this;return this.stream.buf.length>0&&(r=new t),r.setEntry(e.entry),r.setExtensions(e.extensions),r.setFiles(e.files),r.setFileContents(e.files),r.stream.closeWrite(),r}}]),t}();